"use strict";var Y=Object.create;var w=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var ee=Object.getPrototypeOf,te=Object.prototype.hasOwnProperty;var re=(n,r)=>{for(var t in r)w(n,t,{get:r[t],enumerable:!0})},L=(n,r,t,e)=>{if(r&&typeof r=="object"||typeof r=="function")for(let a of X(r))!te.call(n,a)&&a!==t&&w(n,a,{get:()=>r[a],enumerable:!(e=Q(r,a))||e.enumerable});return n};var h=(n,r,t)=>(t=n!=null?Y(ee(n)):{},L(r||!n||!n.__esModule?w(t,"default",{value:n,enumerable:!0}):t,n)),ne=n=>L(w({},"__esModule",{value:!0}),n);var ge={};re(ge,{default:()=>be});module.exports=ne(ge);var q=require("@raycast/api");var v=require("@raycast/api");var g=h(require("react")),f=require("@raycast/api");var $=h(require("node:fs")),b=h(require("node:path")),N=h(require("node:crypto")),A=h(require("node:child_process")),F=require("node:buffer"),y=h(require("node:stream")),B=require("node:util"),d=require("node:fs/promises");var G=require("react/jsx-runtime"),I=h(require("node:os"));var S=globalThis;function M(n){return typeof n!="function"?!1:/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(n))!==null}function ae(n){return n instanceof URLSearchParams?n.toString():n}function H(n,r=[]){function t(e){return"update"in n?n.update(e,"utf8"):n.write(e)}return{dispatch:function(e){e=ae(e),e===null?this._null():this["_"+typeof e](e)},_object:function(e){let a=/\[object (.*)\]/i,i=Object.prototype.toString.call(e),s=a.exec(i)?.[1]??"unknown:["+i+"]";s=s.toLowerCase();let l=null;if((l=r.indexOf(e))>=0){this.dispatch("[CIRCULAR:"+l+"]");return}else r.push(e);if(Buffer.isBuffer(e))return t("buffer:"),t(e.toString("utf8"));if(s!=="object"&&s!=="function"&&s!=="asyncfunction")if(this["_"+s])this["_"+s](e);else throw new Error('Unknown object type "'+s+'"');else{let o=Object.keys(e);o=o.sort(),M(e)||o.splice(0,0,"prototype","__proto__","constructor"),t("object:"+o.length+":");let c=this;return o.forEach(function(u){c.dispatch(u),t(":"),c.dispatch(e[u]),t(",")})}},_array:function(e,a){a=typeof a<"u"?a:!1;let i=this;if(t("array:"+e.length+":"),!a||e.length<=1){e.forEach(function(o){i.dispatch(o)});return}let s=[],l=e.map(function(o){let c=se(),u=r.slice();return H(c,u).dispatch(o),s=s.concat(u.slice(r.length)),c.read().toString()});r=r.concat(s),l.sort(),this._array(l,!1)},_date:function(e){t("date:"+e.toJSON())},_symbol:function(e){t("symbol:"+e.toString())},_error:function(e){t("error:"+e.toString())},_boolean:function(e){t("bool:"+e.toString())},_string:function(e){t("string:"+e.length+":"),t(e.toString())},_function:function(e){t("fn:"),M(e)?this.dispatch("[native]"):this.dispatch(e.toString()),this.dispatch("function-name:"+String(e.name)),this._object(e)},_number:function(e){t("number:"+e.toString())},_xml:function(e){t("xml:"+e.toString())},_null:function(){t("Null")},_undefined:function(){t("Undefined")},_regexp:function(e){t("regex:"+e.toString())},_uint8array:function(e){t("uint8array:"),this.dispatch(Array.prototype.slice.call(e))},_uint8clampedarray:function(e){t("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(e))},_int8array:function(e){t("int8array:"),this.dispatch(Array.prototype.slice.call(e))},_uint16array:function(e){t("uint16array:"),this.dispatch(Array.prototype.slice.call(e))},_int16array:function(e){t("int16array:"),this.dispatch(Array.prototype.slice.call(e))},_uint32array:function(e){t("uint32array:"),this.dispatch(Array.prototype.slice.call(e))},_int32array:function(e){t("int32array:"),this.dispatch(Array.prototype.slice.call(e))},_float32array:function(e){t("float32array:"),this.dispatch(Array.prototype.slice.call(e))},_float64array:function(e){t("float64array:"),this.dispatch(Array.prototype.slice.call(e))},_arraybuffer:function(e){t("arraybuffer:"),this.dispatch(new Uint8Array(e))},_url:function(e){t("url:"+e.toString())},_map:function(e){t("map:");let a=Array.from(e);this._array(a,!0)},_set:function(e){t("set:");let a=Array.from(e);this._array(a,!0)},_file:function(e){t("file:"),this.dispatch([e.name,e.size,e.type,e.lastModified])},_blob:function(){throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){t("domwindow")},_bigint:function(e){t("bigint:"+e.toString())},_process:function(){t("process")},_timer:function(){t("timer")},_pipe:function(){t("pipe")},_tcp:function(){t("tcp")},_udp:function(){t("udp")},_tty:function(){t("tty")},_statwatcher:function(){t("statwatcher")},_securecontext:function(){t("securecontext")},_connection:function(){t("connection")},_zlib:function(){t("zlib")},_context:function(){t("context")},_nodescript:function(){t("nodescript")},_httpparser:function(){t("httpparser")},_dataview:function(){t("dataview")},_signal:function(){t("signal")},_fsevent:function(){t("fsevent")},_tlswrap:function(){t("tlswrap")}}}function se(){return{buf:"",write:function(n){this.buf+=n},end:function(n){this.buf+=n},read:function(){return this.buf}}}function K(n){let r=N.default.createHash("sha1");return H(r).dispatch(n),r.digest("hex")}var k=n=>!!n&&typeof n=="object"&&typeof n.removeListener=="function"&&typeof n.emit=="function"&&typeof n.reallyExit=="function"&&typeof n.listeners=="function"&&typeof n.kill=="function"&&typeof n.pid=="number"&&typeof n.on=="function",E=Symbol.for("signal-exit emitter"),R=class{constructor(){if(this.emitted={afterExit:!1,exit:!1},this.listeners={afterExit:[],exit:[]},this.count=0,this.id=Math.random(),S[E])return S[E];Object.defineProperty(S,E,{value:this,writable:!1,enumerable:!1,configurable:!1})}on(r,t){this.listeners[r].push(t)}removeListener(r,t){let e=this.listeners[r],a=e.indexOf(t);a!==-1&&(a===0&&e.length===1?e.length=0:e.splice(a,1))}emit(r,t,e){if(this.emitted[r])return!1;this.emitted[r]=!0;let a=!1;for(let i of this.listeners[r])a=i(t,e)===!0||a;return r==="exit"&&(a=this.emit("afterExit",t,e)||a),a}},_=class{onExit(){return()=>{}}load(){}unload(){}},T=class{#o;#t;#e;#s;#i;#a;#n;#r;constructor(r){this.#o=process.platform==="win32"?"SIGINT":"SIGHUP",this.#t=new R,this.#a={},this.#n=!1,this.#r=[],this.#r.push("SIGHUP","SIGINT","SIGTERM"),globalThis.process.platform!=="win32"&&this.#r.push("SIGALRM","SIGABRT","SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT"),globalThis.process.platform==="linux"&&this.#r.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT"),this.#e=r,this.#a={};for(let t of this.#r)this.#a[t]=()=>{let e=this.#e.listeners(t),{count:a}=this.#t,i=r;if(typeof i.__signal_exit_emitter__=="object"&&typeof i.__signal_exit_emitter__.count=="number"&&(a+=i.__signal_exit_emitter__.count),e.length===a){this.unload();let s=this.#t.emit("exit",null,t),l=t==="SIGHUP"?this.#o:t;s||r.kill(r.pid,l)}};this.#i=r.reallyExit,this.#s=r.emit}onExit(r,t){if(!k(this.#e))return()=>{};this.#n===!1&&this.load();let e=t?.alwaysLast?"afterExit":"exit";return this.#t.on(e,r),()=>{this.#t.removeListener(e,r),this.#t.listeners.exit.length===0&&this.#t.listeners.afterExit.length===0&&this.unload()}}load(){if(!this.#n){this.#n=!0,this.#t.count+=1;for(let r of this.#r)try{let t=this.#a[r];t&&this.#e.on(r,t)}catch{}this.#e.emit=(r,...t)=>this.#l(r,...t),this.#e.reallyExit=r=>this.#c(r)}}unload(){this.#n&&(this.#n=!1,this.#r.forEach(r=>{let t=this.#a[r];if(!t)throw new Error("Listener not defined for signal: "+r);try{this.#e.removeListener(r,t)}catch{}}),this.#e.emit=this.#s,this.#e.reallyExit=this.#i,this.#t.count-=1)}#c(r){return k(this.#e)?(this.#e.exitCode=r||0,this.#t.emit("exit",this.#e.exitCode,null),this.#i.call(this.#e,this.#e.exitCode)):0}#l(r,...t){let e=this.#s;if(r==="exit"&&k(this.#e)){typeof t[0]=="number"&&(this.#e.exitCode=t[0]);let a=e.call(this.#e,r,...t);return this.#t.emit("exit",this.#e.exitCode,null),a}else return e.call(this.#e,r,...t)}},P=null,ie=(n,r)=>(P||(P=k(process)?new T(process):new _),P.onExit(n,r));function z(n,{timeout:r}={}){let t=new Promise((l,o)=>{n.on("exit",(c,u)=>{l({exitCode:c,signal:u,timedOut:!1})}),n.on("error",c=>{o(c)}),n.stdin&&n.stdin.on("error",c=>{o(c)})}),e=ie(()=>{n.kill()});if(r===0||r===void 0)return t.finally(()=>e());let a,i=new Promise((l,o)=>{a=setTimeout(()=>{n.kill("SIGTERM"),o(Object.assign(new Error("Timed out"),{timedOut:!0,signal:"SIGTERM"}))},r)}),s=t.finally(()=>{clearTimeout(a)});return Promise.race([i,s]).finally(()=>e())}var C=class extends Error{constructor(){super("The output is too big"),this.name="MaxBufferError"}};function oe(n){let{encoding:r}=n,t=r==="buffer",e=new y.default.PassThrough({objectMode:!1});r&&r!=="buffer"&&e.setEncoding(r);let a=0,i=[];return e.on("data",s=>{i.push(s),a+=s.length}),e.getBufferedValue=()=>t?Buffer.concat(i,a):i.join(""),e.getBufferedLength=()=>a,e}async function W(n,r){let t=oe(r);return await new Promise((e,a)=>{let i=s=>{s&&t.getBufferedLength()<=F.constants.MAX_LENGTH&&(s.bufferedData=t.getBufferedValue()),a(s)};(async()=>{try{await(0,B.promisify)(y.default.pipeline)(n,t),e()}catch(s){i(s)}})(),t.on("data",()=>{t.getBufferedLength()>8e7&&i(new C)})}),t.getBufferedValue()}async function j(n,r){n.destroy();try{return await r}catch(t){return t.bufferedData}}async function V({stdout:n,stderr:r},{encoding:t},e){let a=W(n,{encoding:t}),i=W(r,{encoding:t});try{return await Promise.all([e,a,i])}catch(s){return Promise.all([{error:s,exitCode:null,signal:s.signal,timedOut:s.timedOut||!1},j(n,a),j(r,i)])}}var U=class extends Error{constructor(r){super(r),this.name="PermissionError"}};async function ce(n,r,t){if(!(0,$.existsSync)(n))throw new Error("The database does not exist");let e;try{e=await(c=>import(c))("node:sqlite")}catch{return le(n,r,t)}let a=new e.DatabaseSync(n,{open:!1,readOnly:!0}),i=t?.signal;try{a.open()}catch(o){if(console.log(o),o.message.match("(5)")||o.message.match("(14)")){let c;if(!c){let u=b.default.join(I.default.tmpdir(),"useSQL",K(n));await(0,d.mkdir)(u,{recursive:!0}),p(i),c=b.default.join(u,"db.db"),await(0,d.copyFile)(n,c),await(0,d.writeFile)(c+"-shm",""),await(0,d.writeFile)(c+"-wal",""),p(i)}a=new e.DatabaseSync(c,{open:!1,readOnly:!0}),a.open(),p(i)}}let s=a.prepare(r);p(i);let l=s.all();return a.close(),l}async function le(n,r,t){let e=t?.signal,a=A.default.spawn("sqlite3",["--json","--readonly",n,r],{signal:e}),i=z(a),[{error:s,exitCode:l,signal:o},c,u]=await V(a,{encoding:"utf-8"},i);if(p(e),u.match("(5)")||u.match("(14)")){let m;if(!m){let D=b.default.join(I.default.tmpdir(),"useSQL",K(n));await(0,d.mkdir)(D,{recursive:!0}),p(e),m=b.default.join(D,"db.db"),await(0,d.copyFile)(n,m),await(0,d.writeFile)(m+"-shm",""),await(0,d.writeFile)(m+"-wal",""),p(e)}a=A.default.spawn("sqlite3",["--json","--readonly","--vfs","unix-none",m,r],{signal:e}),i=z(a),[{error:s,exitCode:l,signal:o},c,u]=await V(a,{encoding:"utf-8"},i),p(e)}if(s||l!==0||o!==null)throw u.includes("authorization denied")?new U("You do not have permission to access the database."):new Error(u||"Unknown error");return JSON.parse(c.trim()||"[]")}function p(n){if(n?.aborted){let r=new Error("aborted");throw r.name="AbortError",r}}function J(n,r){return ce(n,r)}var O=h(require("fs")),x=h(require("path")),ue=()=>{if(!process.env.HOME)throw new Error("$HOME environment variable is not set.");let n=(0,v.getPreferenceValues)();return n.profilesDirectory?n.profilesDirectory:process.platform=="darwin"?x.default.join(process.env.HOME,"Library","Application Support","zen","Profiles"):x.default.join(process.env.HOME,"AppData","Roaming","zen","Profiles")},fe=n=>{let r=O.default.readdirSync(n),t=(0,v.getPreferenceValues)(),e=r.filter(o=>o.endsWith(t.profileDirectorySuffix))[0];if(e)return e;let a=r.filter(o=>o.endsWith(".Default (release)"))[0];if(a)return a;let i=r.filter(o=>o.endsWith(".Default (beta)"))[0];if(i)return i;let s=r.filter(o=>o.endsWith(".Default (alpha)"))[0];if(s)return s;let l=r.filter(o=>o.includes(".Default ("))[0];return l||""};var de=()=>{let n=ue();return x.default.join(n,fe(n),"places.sqlite")};var he=n=>n.map(r=>`moz_places.title LIKE '%${r}%'`).join(" AND "),pe=(n,r)=>{let t=(0,v.getPreferenceValues)(),e=n?n.trim().split(" "):[];return`SELECT
            id, url, title,
            datetime(last_visit_date/1000000,'unixepoch') as lastVisited
          FROM moz_places
          ${e.length>0?`WHERE ${he(e)}`:""}
          ORDER BY last_visit_date DESC LIMIT ${r||t.limitResults};`},Z=async(n,r)=>{let t=pe(n,r),e=de();return O.default.existsSync(e)?await J(e,t):"Zen Browser is not installed."};var me=async({searchText:n})=>{let{aiSearchHistoryLimitResults:r}=(0,q.getPreferenceValues)();return parseInt(r)>0?await Z(n,parseInt(r)):r=="0"?"You have disabled the AI search history, which limits the results to zero. Please adjust this setting in the preferences.":"The limit for the AI search history is incorrect. Please adjust this setting in the preferences."},be=me;
